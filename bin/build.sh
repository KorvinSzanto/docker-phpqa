#!/usr/bin/env bash

_DEFAULT=71
_VERSION=$1
if [ -z "$_VERSION" ]; then
    _VERSION=$_DEFAULT
fi

_72_PHP_VERSION="7.2.0alpha2"
_72_GPG_KEYS=""
_72_PHP_SHA256=""
_72_PHP_MD5=""
_72_CHECK_SIGNATURE=false
_72_CUSTOM_URL="https://downloads.php.net/~pollita/php-${_72_PHP_VERSION}.tar.xz"

_71_PHP_VERSION="7.1.6"
_71_GPG_KEYS="A917B1ECDA84AEC2B568FED6F50ABC807BD5DCD0 528995BFEDFBA7191D46839EF9BA0ADA31CBD89E"
_71_PHP_SHA256="01584dc521ab7ec84b502b61952f573652fe6aa00c18d6d844fb9209f14b245b"
_71_PHP_MD5="eafc7a79cc8cc62c9292c96f9c9ccf90"
_71_CHECK_SIGNATURE=true
_71_CUSTOM_URL=''

_70_PHP_VERSION="7.0.20"
_70_GPG_KEYS="1A4E8B7277C42E53DBA9C7B9BCAA30EA9C0D5763 6E4F6AB321FDC07F2C332E3AC2BF0BC433CFC8B3"
_70_PHP_SHA256="31b9cf1fb83fe3cd82c2f6603a0ae81ae6abacb5286827e362d8f85e68908e0a"
_70_PHP_MD5="e84615871c1c6dbd0860746a31f3a7c8"
_70_CHECK_SIGNATURE=true
_70_CUSTOM_URL=''

_56_PHP_VERSION="5.6.30"
_56_GPG_KEYS="0BD78B5F97500D450838F95DFE857D9A90D90EC1 6E4F6AB321FDC07F2C332E3AC2BF0BC433CFC8B3"
_56_PHP_SHA256="a363185c786432f75e3c7ff956b49c3369c3f6906a6b10459f8d1ddc22f70805"
_56_PHP_MD5="68753955a8964ae49064c6424f81eb3e"
_56_CHECK_SIGNATURE=true
_56_CUSTOM_URL=''

_55_PHP_VERSION="5.5.38"
_55_GPG_KEYS="0BD78B5F97500D450838F95DFE857D9A90D90EC1 0B96609E270F565C13292B24C13C70B87267B52D"
_55_PHP_SHA256="473c81ebb2e48ca468caee031762266651843d7227c18a824add9b07b9393e38"
_55_PHP_MD5="312244a0eecad602a1555ed2434e223f"
_55_CHECK_SIGNATURE=true
_55_CUSTOM_URL=''

_PHP_VERSION="_${_VERSION}_PHP_VERSION"
_GPG_KEYS="_${_VERSION}_GPG_KEYS"
_PHP_SHA256="_${_VERSION}_PHP_SHA256"
_PHP_MD5="_${_VERSION}_PHP_MD5"
_CHECK_SIGNATURE="_${_VERSION}_CHECK_SIGNATURE"
_CUSTOM_URL="_${_VERSION}_CUSTOM_URL"

cd `git rev-parse --show-toplevel`
docker build \
    --build-arg BUILD_PHP_VERSION="${!_PHP_VERSION}" \
    --build-arg BUILD_GPG_KEYS="${!_GPG_KEYS}" \
    --build-arg BUILD_PHP_SHA256="${!_PHP_SHA256}" \
    --build-arg BUILD_PHP_MD5="${!_PHP_MD5}" \
    --build-arg BUILD_CHECK_SIGNATURE="${!_CHECK_SIGNATURE}" \
    --build-arg BUILD_CUSTOM_URL="${!_CUSTOM_URL}" \
    -t brunoric/phpqa:${_VERSION} src/
cd -